# This is just an example to get you started. A typical hybrid package
# uses this file as the main entry point of the application.

import dupfinderpkg/submodule
import std/sha1
import os
import strutils

when isMainModule:
  echo(getWelcomeMessage())
  echo("Enter location: ")
  var dirname = readLine(stdin)
  dirname.stripLineEnd
  #let dirname = "/mnt/AnTiX"
  var h: seq[SecureHash] = @[]
  var dl: seq[string] = @[]
  
  # Recursively travel directories add files to a list
  for f in walkDirRec(dirname):
    echo("Added: " & " " & f)
    dl.add(f)
    
  # Compute secure file Hash
  for f in dl:
    echo("Computed: " & " " & f)
    h.add(cHash(f))

  # Remove the files with identical SecureHash
  for i in 0..h.len()-1:
    for j in countDown(h.len()-1, i, 1):
      if i != j:
        if h[i] == h[j]:
          echo(dl[i] & "\n" & dl[j])
          if os.existsFile(dl[i]):
            echo("File marked for Removal: " & dl[i])
            if os.tryRemoveFile(dl[i]):
              echo("Removed: " & " " & dl[i])
            else:
              echo("Problem deleting file: " & " " & dl[i])
          elif os.existsDir(dl[i]):
            echo("Dir name: " & " " & dl[i])
          else: discard
        else: discard
      else: discard

